---
title: 6.824 Lab2B
date: 
categories: Lab
tags: 
- distributed system
---

首先进行任务拆分：
1. 实现Start方法，实现leader自己更新记录
2. leader向follower发送AppendEntries
3. follower接收处理AppendEntries
4. leader得到follower返回结果（或返回失败）时的处理
5. server通过applyCh返回结果
6. 确保选举成功的candidate包含所有已提交的记录（实现election restriction）


### 提交任务
```go
type ApplyMsg struct {
	CommandValid bool
	Command      interface{}
	CommandIndex int
}

type Raft struct {
    //...
    applyCh         chan ApplyMsg
    //...
}

func (rf *Raft) startApplyLogs() {
	for rf.lastApplied < rf.commitIndex {
		rf.lastApplied++
		msg := ApplyMsg{}
		msg.CommandIndex = rf.lastApplied
		msg.Command = rf.logEntries[rf.lastApplied-1].Command
		msg.CommandValid = true
		rf.applyCh <- msg
	}
}
```


